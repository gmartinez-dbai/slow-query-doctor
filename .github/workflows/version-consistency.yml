name: Validate Version Consistency

on:
  pull_request:
    paths:
      - VERSION
      - Dockerfile
      - slowquerydoctor/__init__.py
      - scripts/propagate_version.py
  push:
    branches:
      - main
      - develop
      - 'release/*'
      - 'feature/*'

jobs:
  version-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          pip install ruamel.yaml
      - name: Validate version consistency
        run: |
          python3 scripts/propagate_version.py --dry-run
      - name: Fail if inconsistencies found
        run: |
          git status --porcelain | grep . && exit 1 || echo "Version is consistent"
